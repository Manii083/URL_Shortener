{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/URL_SHORTENER/lib/database.js"],"sourcesContent":["import { Pool } from 'pg';\r\nimport dotenv from 'dotenv';\r\n\r\ndotenv.config();\r\n\r\nconst pool = new Pool({\r\n  connectionString: process.env.DATABASE_URL,\r\n  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false\r\n});\r\n\r\nexport async function query(text, params) {\r\n  const client = await pool.connect();\r\n  try {\r\n    const result = await client.query(text, params);\r\n    return result;\r\n  } finally {\r\n    client.release();\r\n  }\r\n}\r\n\r\nexport async function initDB() {\r\n  await query(`\r\n    CREATE TABLE IF NOT EXISTS urls (\r\n      id SERIAL PRIMARY KEY,\r\n      slug VARCHAR(10) UNIQUE NOT NULL,\r\n      original_url TEXT NOT NULL,\r\n      clicks INTEGER DEFAULT 0,\r\n      created_at TIMESTAMP DEFAULT NOW()\r\n    );\r\n    CREATE INDEX IF NOT EXISTS idx_slug ON urls(slug);\r\n  `);\r\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;;;;;AAEA,gHAAM,CAAC,MAAM;AAEb,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK,sCAAwC,0BAAgC;AAC/E;AAEO,eAAe,MAAM,IAAI,EAAE,MAAM;IACtC,MAAM,SAAS,MAAM,KAAK,OAAO;IACjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAAC,MAAM;QACxC,OAAO;IACT,SAAU;QACR,OAAO,OAAO;IAChB;AACF;AAEO,eAAe;IACpB,MAAM,MAAM,CAAC;;;;;;;;;EASb,CAAC;AACH"}},
    {"offset": {"line": 91, "column": 0}, "map": {"version":3,"sources":["file:///C:/URL_SHORTENER/pages/api/shorten.js"],"sourcesContent":["import { query } from '../../lib/database';\r\nimport { nanoid } from 'nanoid';\r\n\r\nexport default async function handler(req, res) {\r\n  if (req.method !== 'POST') {\r\n    return res.status(405).json({ error: 'Method not allowed' });\r\n  }\r\n\r\n  const { url } = req.body;\r\n\r\n  if (!url) {\r\n    return res.status(400).json({ error: 'URL is required' });\r\n  }\r\n\r\n  try {\r\n    // Validate URL\r\n    new URL(url);\r\n\r\n    // Generate unique slug\r\n    let slug;\r\n    let exists;\r\n    let attempts = 0;\r\n    \r\n    do {\r\n      slug = nanoid(6);\r\n      const result = await query('SELECT slug FROM urls WHERE slug = $1', [slug]);\r\n      exists = result.rows.length > 0;\r\n      attempts++;\r\n      \r\n      // Safety check to prevent infinite loop\r\n      if (attempts > 10) {\r\n        return res.status(500).json({ error: 'Failed to generate unique slug' });\r\n      }\r\n    } while (exists);\r\n\r\n    // Insert into database\r\n    await query(\r\n      'INSERT INTO urls (slug, original_url) VALUES ($1, $2)',\r\n      [slug, url]\r\n    );\r\n\r\n    res.status(200).json({ \r\n      slug, \r\n      shortUrl: slug,\r\n      originalUrl: url\r\n    });\r\n  } catch (error) {\r\n    console.error('Shorten error:', error);\r\n    \r\n    if (error.message.includes('relation \"urls\" does not exist')) {\r\n      // Table doesn't exist - we need to initialize it first\r\n      return res.status(500).json({ \r\n        error: 'Database not ready. Please initialize the database first.' \r\n      });\r\n    }\r\n    \r\n    if (error.code === '23505') {\r\n      // Unique constraint violation - try again\r\n      return handler(req, res);\r\n    }\r\n    \r\n    res.status(400).json({ error: 'Invalid URL' });\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,MAAM,EAAE,GAAG,EAAE,GAAG,IAAI,IAAI;IAExB,IAAI,CAAC,KAAK;QACR,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAkB;IACzD;IAEA,IAAI;QACF,eAAe;QACf,IAAI,IAAI;QAER,uBAAuB;QACvB,IAAI;QACJ,IAAI;QACJ,IAAI,WAAW;QAEf,GAAG;YACD,OAAO,IAAA,sHAAM,EAAC;YACd,MAAM,SAAS,MAAM,IAAA,iHAAK,EAAC,yCAAyC;gBAAC;aAAK;YAC1E,SAAS,OAAO,IAAI,CAAC,MAAM,GAAG;YAC9B;YAEA,wCAAwC;YACxC,IAAI,WAAW,IAAI;gBACjB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;oBAAE,OAAO;gBAAiC;YACxE;QACF,QAAS,OAAQ;QAEjB,uBAAuB;QACvB,MAAM,IAAA,iHAAK,EACT,yDACA;YAAC;YAAM;SAAI;QAGb,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YACnB;YACA,UAAU;YACV,aAAa;QACf;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kBAAkB;QAEhC,IAAI,MAAM,OAAO,CAAC,QAAQ,CAAC,mCAAmC;YAC5D,uDAAuD;YACvD,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAC1B,OAAO;YACT;QACF;QAEA,IAAI,MAAM,IAAI,KAAK,SAAS;YAC1B,0CAA0C;YAC1C,OAAO,QAAQ,KAAK;QACtB;QAEA,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAc;IAC9C;AACF"}}]
}
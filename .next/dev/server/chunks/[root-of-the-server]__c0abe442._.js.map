{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/URL_SHORTENER/pages/api/shorten.js"],"sourcesContent":["import { query } from '../../../lib/database';\r\nimport { nanoid } from 'nanoid';\r\n\r\nexport default async function handler(req, res) {\r\n  if (req.method !== 'POST') {\r\n    return res.status(405).json({ error: 'Method not allowed' });\r\n  }\r\n\r\n  const { url } = req.body;\r\n\r\n  if (!url) {\r\n    return res.status(400).json({ error: 'URL is required' });\r\n  }\r\n\r\n  try {\r\n    new URL(url);\r\n\r\n    let slug;\r\n    let exists;\r\n    \r\n    do {\r\n      slug = nanoid(6);\r\n      const result = await query('SELECT slug FROM urls WHERE slug = $1', [slug]);\r\n      exists = result.rows.length > 0;\r\n    } while (exists);\r\n\r\n    await query(\r\n      'INSERT INTO urls (slug, original_url) VALUES ($1, $2)',\r\n      [slug, url]\r\n    );\r\n\r\n    res.status(200).json({ slug, shortUrl: slug });\r\n  } catch (error) {\r\n    res.status(400).json({ error: 'Invalid URL' });\r\n  }\r\n}"],"names":[],"mappings":";;;;;;;;;AACA;;;;;;;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAqB;IAC5D;IAEA,MAAM,EAAE,GAAG,EAAE,GAAG,IAAI,IAAI;IAExB,IAAI,CAAC,KAAK;QACR,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAkB;IACzD;IAEA,IAAI;QACF,IAAI,IAAI;QAER,IAAI;QACJ,IAAI;QAEJ,GAAG;YACD,OAAO,IAAA,sHAAM,EAAC;YACd,MAAM,SAAS,MAAM,MAAM,yCAAyC;gBAAC;aAAK;YAC1E,SAAS,OAAO,IAAI,CAAC,MAAM,GAAG;QAChC,QAAS,OAAQ;QAEjB,MAAM,MACJ,yDACA;YAAC;YAAM;SAAI;QAGb,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE;YAAM,UAAU;QAAK;IAC9C,EAAE,OAAO,OAAO;QACd,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAc;IAC9C;AACF"}}]
}